# Claude Code Mixin - OSS統合コマンド

このコマンドは、`repos/`配下の複数のClaude Code向けOSSを分析・統合して、ベストプラクティスを集めた統合版を`ccmixin/`に生成します。

---

## タスク概要

あなた（Claude Code）は以下のタスクを実行してください：

### 1. リポジトリの検出
- `repos/`ディレクトリ配下のサブディレクトリをスキャン
- 少なくとも2つのOSSリポジトリが必要
  - 0-1個の場合: エラーメッセージを表示して終了
  - 2個: 両方を統合
  - 3個以上: すべてを統合（ユーザーに確認）

### 2. ディレクトリ構造の理解
各リポジトリについて：
- すべてのファイルとディレクトリをスキャン
- `.git/`, `node_modules/`, `.env`, `venv/`, `__pycache__/`, `.DS_Store`, `*.log` を除外
- ファイルの種類を分類:
  - 設定ファイル: `.claude/settings.json`
  - スラッシュコマンド: `.claude/commands/*.md`
  - ドキュメント: `CLAUDE.md`, `README.md`
  - スクリプト: `scripts/`
  - その他のファイル

### 3. 既存の出力フォルダ確認
- `ccmixin/`フォルダが既に存在する場合:
  - ユーザーに削除していいか確認（AskUserQuestion使用）
  - 削除が許可されたら削除、拒否されたら終了

### 4. ファイル比較と衝突検出

#### A. 独自ファイル（片方にしか存在しないファイル）
- **アクション**: そのまま`ccmixin/`にコピー
- ユーザー確認: 不要

#### B. 同名だが内容が異なるファイル

**特殊なマージが必要なファイル:**

##### `CLAUDE.md`
- **アクション**: 両方の内容を理解し、統合版を生成
- **マージ方法**:
  1. 両方のファイルを読んで理解
  2. 共通セクションと独自セクションを識別
  3. 重複する情報を削除
  4. より詳細で有用な情報を優先
  5. セクション構造を整理して統合
  6. 新しい統合版を作成
- ユーザー確認: 不要（自動的に最適化）

##### `README.md`
- **アクション**: 両方の内容を理解し、統合版を生成
- **マージ方法**:
  1. プロジェクト概要セクションを統合
  2. インストール手順をマージ
  3. 使用方法セクションを統合
  4. 両方の良い例を含める
  5. ライセンス情報を統合
  6. 新しい統合版を作成
- ユーザー確認: 不要（自動的に最適化）

##### `.claude/settings.json`
- **アクション**: JSON構造を理解し、統合版を生成
- **マージ方法**:
  1. 両方のJSONを読み込み
  2. `hooks.PreToolUse`配列を統合（重複を除去）
  3. `hooks.PostToolUse`配列を統合（重複を除去）
  4. その他の設定項目をマージ（衝突する場合はユーザーに確認）
  5. 正しいJSON形式で出力
- ユーザー確認: 衝突がある場合のみ

##### `.claude/commands/<command>.md` (スラッシュコマンド)
- 同名のコマンドファイルが存在する場合:
  - **アクション**: ユーザーに選択を促す（AskUserQuestion使用）
  - **選択肢**:
    1. Repo1のコマンドを使用
    2. Repo2のコマンドを使用
    3. 両方を保持（リネーム: `<command>-1.md`, `<command>-2.md`）
    4. 両方の内容を統合した新しいコマンドを作成

##### その他のファイル（スクリプト、設定ファイルなど）
- **アクション**: ユーザーに選択を促す（AskUserQuestion使用）
- **選択肢**:
  1. Repo1のファイルを使用
  2. Repo2のファイルを使用
  3. 両方を保持（リネーム）
  4. ファイル内容を確認して手動で統合

#### C. 同名で内容も同じファイル
- **アクション**: 1つだけコピー
- ユーザー確認: 不要

### 5. 統合実行

1. `ccmixin/`ディレクトリを作成
2. すべてのファイルを適切にマージ・コピー:
   - 独自ファイル → そのままコピー
   - `CLAUDE.md` → 統合版を生成
   - `README.md` → 統合版を生成
   - `.claude/settings.json` → 統合版を生成
   - スラッシュコマンド → ユーザーの選択に従う
   - その他の衝突ファイル → ユーザーの選択に従う
3. ディレクトリ構造を保持

### 6. 完了レポート

統合完了後、以下を表示:
```
✅ Claude Code Mixin 完了！

📊 統合結果:
- 統合元リポジトリ: <repo1-name>, <repo2-name>
- 総ファイル数: <count>
- 統合されたファイル: <count>
- コピーされたファイル: <count>
- スキップされたファイル: <count>

📁 出力先: ccmixin/

🎯 次のステップ:
1. ccmixin/フォルダの内容を確認
2. 必要に応じて手動調整
3. ccmixin/を新しいリポジトリとして使用
```

---

## 重要な注意事項

- **インテリジェントなマージ**: ファイルの内容を理解し、単純な連結ではなく、意味のある統合を行う
- **品質重視**: 重複や矛盾を排除し、最高のベストプラクティスを生成する
- **ユーザー確認**: 重要な判断が必要な場合は必ずユーザーに確認する
- **透明性**: 何をしているか、なぜそうしているかをユーザーに説明する

---

## エラーハンドリング

- `repos/`が存在しない → エラーメッセージと使い方を表示
- リポジトリが1個以下 → 最低2個必要というメッセージを表示
- 読み取り権限がない → 権限エラーを表示
- ディスク容量不足 → エラーを表示

---

実行: `repos/`配下のリポジトリを検出し、上記のタスクを実行してください。
